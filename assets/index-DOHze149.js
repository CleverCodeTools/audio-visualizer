(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))l(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const e of c.addedNodes)e.tagName==="LINK"&&e.rel==="modulepreload"&&l(e)}).observe(document,{childList:!0,subtree:!0});function t(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function l(r){if(r.ep)return;r.ep=!0;const c=t(r);fetch(r.href,c)}})();const u=1e3,h=400,s={smoothing:.6,fft:8,minDecibels:-70,glow:10,fillOpacity:.6,lineWidth:1,blend:"screen",shift:50,width:60,amp:1,color1:[203,36,128],color2:[41,200,192],color3:[24,137,218]},b=[1,3,0,4,2],m=i=>{const n=document.getElementById(i);if(!n)throw new Error(`Missing #${i}`);return n},p=(i,n)=>i<n?n:i,v=i=>{const n=["color1","color2","color3"][i];return s[n].map(Math.floor)},g=()=>{const i=new dat.GUI;i.close(),i.addColor(s,"color1"),i.addColor(s,"color2"),i.addColor(s,"color3"),i.add(s,"fillOpacity",0,1),i.add(s,"lineWidth",0,10,1),i.add(s,"glow",0,100),i.add(s,"blend",["normal","multiply","screen","overlay","lighten","difference"]),i.add(s,"smoothing",0,1),i.add(s,"minDecibels",-100,0),i.add(s,"amp",0,5),i.add(s,"width",0,60),i.add(s,"shift",0,200)};class w{constructor(n){this.canvas=n;const t=n.getContext("2d");if(!t)throw new Error("Canvas 2D context unavailable");this.ctx=t}ctx;audio;analyser;freqs;async start(){const n=window.AudioContext??window.webkitAudioContext;this.audio=new n,this.analyser=this.audio.createAnalyser();const t=await navigator.mediaDevices.getUserMedia({audio:!0});this.audio.createMediaStreamSource(t).connect(this.analyser),this.freqs=new Uint8Array(new ArrayBuffer(this.analyser.frequencyBinCount)),requestAnimationFrame(this.visualize)}freq=(n,t)=>{const l=2*n+b[t]*6;return this.freqs?.[l]??0};scale=n=>(3-Math.abs(2-n))/3*s.amp;path=n=>{const t=this.ctx,l=v(n);t.fillStyle=`rgba(${l}, ${s.fillOpacity})`,t.strokeStyle=t.shadowColor=`rgb(${l})`,t.lineWidth=s.lineWidth,t.shadowBlur=s.glow,t.globalCompositeOperation=s.blend==="normal"?"source-over":s.blend;const r=h/2,c=(u-15*s.width)/2,e=Array.from({length:15},(y,d)=>c+n*s.shift+d*s.width),o=Array.from({length:5},(y,d)=>p(r-this.scale(d)*this.freq(n,d),0)),a=2*r;t.beginPath(),t.moveTo(0,r),t.lineTo(e[0],r+1),t.bezierCurveTo(e[1],r+1,e[2],o[0],e[3],o[0]),t.bezierCurveTo(e[4],o[0],e[4],o[1],e[5],o[1]),t.bezierCurveTo(e[6],o[1],e[6],o[2],e[7],o[2]),t.bezierCurveTo(e[8],o[2],e[8],o[3],e[9],o[3]),t.bezierCurveTo(e[10],o[3],e[10],o[4],e[11],o[4]),t.bezierCurveTo(e[12],o[4],e[12],r,e[13],r),t.lineTo(u,r+1),t.lineTo(e[13],r-1),t.bezierCurveTo(e[12],r,e[12],a-o[4],e[11],a-o[4]),t.bezierCurveTo(e[10],a-o[4],e[10],a-o[3],e[9],a-o[3]),t.bezierCurveTo(e[8],a-o[3],e[8],a-o[2],e[7],a-o[2]),t.bezierCurveTo(e[6],a-o[2],e[6],a-o[1],e[5],a-o[1]),t.bezierCurveTo(e[4],a-o[1],e[4],a-o[0],e[3],a-o[0]),t.bezierCurveTo(e[2],a-o[0],e[1],r,e[0],r),t.lineTo(0,r),t.fill(),t.stroke()};visualize=()=>{!this.analyser||!this.freqs||(this.analyser.smoothingTimeConstant=s.smoothing,this.analyser.fftSize=2**s.fft,this.analyser.minDecibels=s.minDecibels,this.analyser.maxDecibels=0,this.analyser.getByteFrequencyData(this.freqs),this.canvas.width=u,this.canvas.height=h,this.path(0),this.path(1),this.path(2),requestAnimationFrame(this.visualize))}}g();const C=m("canvas"),f=m("start"),T=new w(C);f.addEventListener("click",async()=>{f.remove();try{await T.start()}catch(i){document.body.innerHTML="<h1>Serve HTTPS per usare il microfono.</h1>",console.error(i)}});
